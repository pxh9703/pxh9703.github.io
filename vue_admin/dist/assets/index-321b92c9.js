import{e as d,o as b,c as J,a as K,n as e,x as o,b as n,q as E,y as u,t as L,A as D}from"./index-95237cf6.js";import{E as O,u as G,a as H}from"./userRoutes-d1f83e5a.js";import{a as M,E as Q,d as W,e as X,b as Y,c as Z,f as ee}from"./el-input-678b8cd4.js";import{E as te}from"./el-select-f6400713.js";import{E as le}from"./el-button-f73331d5.js";import{u as oe}from"./useRoleApi-0f4d513a.js";import"./index-e7c8ab6b.js";const ae={class:"btn-group mb-2"},fe={__name:"index",setup(ne){const c=oe(),v=d("add"),p=d(!1),s=d({}),h={},r=d({list:[],total:20,page:1,pageSize:10}),m=()=>{c.getRoleList({page:r.value.page,limit:r.value.pageSize}).then(a=>{console.log(a),r.value.list=a.rows})},S=a=>{r.value.pageSize=a,m()},T=a=>{r.value.page=a,m()};m();const k=(a,t)=>{const i=t?0:1;c.updateRoleStatus({id:a,status:i}).then(()=>{m()})},$=a=>{p.value=!0,v.value="edit",s.value=a},I=a=>{c.deleteRole({id:a}).then(()=>{m()})},B=()=>{switch(v.value){case"add":c.createRole(s.value).then(()=>{m()});break;case"edit":c.updateRole(s.value).then(()=>{m()});break}p.value=!1},g=d(!1),U=d(null),C=d(null),R=d([]),w=G();(()=>{w.getRouterlist().then(a=>{R.value=a.rows})})();const N=()=>{const a=C.value.getCheckedNodes().map(t=>t.id);console.log(a),c.setRolePermission({id:U.value,routes:JSON.stringify(a)}).then(t=>{console.log(t),location.reload()})};return(a,t)=>{const i=le,f=W,y=te,P=X,A=M,F=O,V=Y,z=Z,j=ee,x=Q,q=H;return b(),J("div",null,[K("div",ae,[e(i,{size:"small",plain:"",onClick:t[0]||(t[0]=l=>[v.value="add",p.value=!0,s.value={}])},{default:o(()=>[u(" 添加角色 ")]),_:1})]),e(A,{data:n(r).list,border:""},{default:o(()=>[e(f,{prop:"id",label:"ID",align:"center",width:"80"}),e(f,{prop:"roleKey","show-overflow-tooltip":"",label:"角色唯一标识",align:"center"}),e(f,{prop:"name",label:"角色",align:"center"}),e(f,{prop:"introduction",label:"角色介绍","show-overflow-tooltip":"",width:"180"},{default:o(({row:l})=>[u(L(l.introduction?l.introduction:"暂无介绍"),1)]),_:1}),e(f,{prop:"status",label:"角色状态"},{default:o(({row:l})=>[l.status?(b(),D(y,{key:0,type:"success",onClick:_=>k(l.id,l.status)},{default:o(()=>[u("正常")]),_:2},1032,["onClick"])):(b(),D(y,{key:1,type:"danger ",onClick:_=>k(l.id,l.status)},{default:o(()=>[u("禁用")]),_:2},1032,["onClick"]))]),_:1}),e(f,{label:"操作"},{default:o(({row:l})=>[e(i,{size:"small",onClick:_=>$(l)},{default:o(()=>[u("编辑")]),_:2},1032,["onClick"]),e(P,{title:"你确认删除吗?","confirm-button-text":"确认","cancel-button-text":"取消",onConfirm:_=>I(l.id)},{reference:o(()=>[e(i,{size:"small",type:"danger",plain:""},{default:o(()=>[u("删除")]),_:1})]),_:2},1032,["onConfirm"]),e(i,{size:"small",type:"danger",plain:"",onClick:t[1]||(t[1]=_=>g.value=!0)},{default:o(()=>[u("角色权限设置")]),_:1})]),_:1})]),_:1},8,["data"]),e(F,{"current-page":n(r).page,"page-sizes":[10,20,30,40],"page-size":n(r).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n(r).total,onSizeChange:S,onCurrentChange:T},null,8,["current-page","page-size","total"]),e(x,{modelValue:n(p),"onUpdate:modelValue":t[6]||(t[6]=l=>E(p)?p.value=l:null),title:n(v)=="add"?"添加角色":"编辑角色"},{footer:o(()=>[e(i,{onClick:t[5]||(t[5]=l=>p.value=!1)},{default:o(()=>[u("取消")]),_:1}),e(i,{type:"primary",onClick:B},{default:o(()=>[u("提交")]),_:1})]),default:o(()=>[e(j,{modelValue:n(s),"onUpdate:modelValue":t[4]||(t[4]=l=>E(s)?s.value=l:null),model:n(s),rules:h},{default:o(()=>[e(z,{label:"角色名称"},{default:o(()=>[e(V,{modelValue:n(s).name,"onUpdate:modelValue":t[2]||(t[2]=l=>n(s).name=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(z,{label:"角色介绍"},{default:o(()=>[e(V,{modelValue:n(s).introduction,"onUpdate:modelValue":t[3]||(t[3]=l=>n(s).introduction=l),placeholder:"请输入角色介绍"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","model"])]),_:1},8,["modelValue","title"]),e(x,{modelValue:n(g),"onUpdate:modelValue":t[8]||(t[8]=l=>E(g)?g.value=l:null),title:"编辑角色权限"},{footer:o(()=>[e(i,{onClick:t[7]||(t[7]=l=>g.value=!1)},{default:o(()=>[u("取消")]),_:1}),e(i,{type:"primary",onClick:N},{default:o(()=>[u("提交")]),_:1})]),default:o(()=>[e(q,{ref_key:"treeRoutes",ref:C,data:n(R),props:{label:"name",children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":"","expand-on-click-node":!1},null,8,["data"])]),_:1},8,["modelValue"])])}}};export{fe as default};
